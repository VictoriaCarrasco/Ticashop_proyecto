{% extends "base.html" %}
{% block title %}Vacaciones{% endblock %}
{% block content %}
<div class="toolbar">
  <h1 class="page-title m0">Solicitudes de Vacaciones</h1>
  <div class="spacer"></div>
  <a class="btn ghost" href="#" onclick="mostrarConfirmacion(event)">Restablecer Días</a>
  <a class="btn ghost" href="{% url 'vacaciones_export' %}">Exportar</a>
  <a class="btn primary" href="{% url 'vacaciones_solicitar' %}"> Pedir Vacaciones</a>
</div>

<div class="table-wrap">
  <table class="table">
    <thead>
      <tr>
        <th>Empleado</th>
        <th>Fecha Inicio</th>
        <th>Fecha Fin</th>
        <th>Días</th>
        <th>Estado</th>
        <th class="right">Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for v in solicitudes %}
      <tr>
        <td>{{ v.empleado.nombre }}</td>
        <td>{{ v.fecha_inicio }}</td>
        <td>{{ v.fecha_fin }}</td>
        <td class="num">{{ v.dias }}</td>
        <td>
          {% if v.estado == "APROBADA" %}<span class="badge ok">Aprobada</span>
          {% elif v.estado == "RECHAZADA" %}<span class="badge danger">Rechazada</span>
          {% else %}<span class="badge warn">Pendiente</span>{% endif %}
        </td>
        <td class="right">
          <a class="btn ghost" href="{% url 'vacaciones_detalle' v.id %}">Ver</a>
          {% if v.estado == "PENDIENTE" %}
            <a class="btn success" href="{% url 'vacaciones_aprobar' v.id %}">Aprobar</a>
            <a class="btn danger" href="{% url 'vacaciones_rechazar' v.id %}">Rechazar</a>
          {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="6" class="empty">Sin solicitudes.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Modal de confirmación personalizado -->
<div id="modalConfirmacion" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; justify-content: center; align-items: center;">
  <div style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); max-width: 450px; text-align: center;">
    <h3 style="margin: 0 0 20px 0; color: #333;">Restablecer Días de Vacaciones</h3>
    <p style="margin-bottom: 30px; color: #666; font-size: 15px;">¿Está seguro que desea restablecer los días de vacaciones de todos los empleados a 15 días?</p>
    <div style="display: flex; gap: 10px; justify-content: center;">
      <button onclick="confirmarRestablecer()" style="padding: 12px 30px; background: #2247eeff; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 15px; font-weight: 500;">Aceptar</button>
      <button onclick="cerrarModal()" style="padding: 12px 30px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 15px; font-weight: 500;">Cancelar</button>
    </div>
  </div>
</div>

<script>
function mostrarConfirmacion(event) {
  event.preventDefault();
  const modal = document.getElementById('modalConfirmacion');
  modal.style.display = 'flex';
}

function cerrarModal() {
  const modal = document.getElementById('modalConfirmacion');
  modal.style.display = 'none';
}

function confirmarRestablecer() {
  window.location.href = "{% url 'vacaciones_restablecer' %}";
}

// Cerrar modal al hacer clic fuera
document.getElementById('modalConfirmacion').addEventListener('click', function(e) {
  if (e.target === this) {
    cerrarModal();
  }
});
</script>

{% endblock %}
