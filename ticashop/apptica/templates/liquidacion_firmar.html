{% extends "base.html" %}

{% block content %}
<h2>Firmar Liquidaci√≥n - {{ liquidacion.periodo|date:"F Y" }}</h2>

<p>Empleado: {{ liquidacion.empleado.nombre }}</p>
<p>Monto: ${{ liquidacion.monto_total|floatformat:0 }}</p>

<div style="border: 2px solid #000; display: inline-block;">
    <canvas id="signatureCanvas" width="500" height="200" style="cursor: crosshair;"></canvas>
</div>
<br>
<button onclick="clearSignature()">Limpiar</button>
<button onclick="saveSignature()">Firmar y Guardar</button>

<form id="signatureForm" method="POST" style="display: none;">
    {% csrf_token %}
    <input type="hidden" name="firma" id="firmaInput">
</form>

<script>
const canvas = document.getElementById('signatureCanvas');
const ctx = canvas.getContext('2d');
let drawing = false;

canvas.addEventListener('mousedown', () => drawing = true);
canvas.addEventListener('mouseup', () => drawing = false);
canvas.addEventListener('mousemove', draw);

function draw(event) {
    if (!drawing) return;
    ctx.lineWidth = 2;
    ctx.lineCap = 'round';
    ctx.strokeStyle = '#000';
    
    ctx.lineTo(event.offsetX, event.offsetY);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(event.offsetX, event.offsetY);
}

function clearSignature() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
}

function saveSignature() {
    const dataURL = canvas.toDataURL('image/png');
    document.getElementById('firmaInput').value = dataURL;
    document.getElementById('signatureForm').submit();
}
</script>
{% endblock %}
